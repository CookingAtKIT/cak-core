version: "3.8"
networks:
  cak-net:
    ipam:
      driver: default
      config:
        subnet: "172.16.238.0/29"
services:
  web:
    build: .
    hostname: cakCore
    ports:
      - "2999:2999"
    volumes:
    links:
      - mongo
      - minio
    networks:
      cak-net:
        - ipv4_address: "172.16.238.1"
  mongo:
    image: mongo
    hostname: mongo
    environment:
      MONGO_INITDB_ROOT_USERNAME: key
      MONGO_INITDB_ROOT_PASSWORD: secret
    volumes:
    - mongoData:/data/db
  networks:
    cak-net:
      - ipv4_address: "172.16.238.2"
  minio:
    image: minio/minio
    hostname: minio
    volumes:
    - minioData:/data
    environment:
      MINIO_ACCESS_KEY: key
      MINIO_SECRET_KEY: secret
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:9000/minio/health/live" ]
      interval: 30s
      timeout: 20s
      retries: 3
    networks:
      cak-net:
        - ipv4_address: "172.16.238.3"
volumes:
  minioData: {}
  mongoData: {}
